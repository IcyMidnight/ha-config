mirror_update:
  sequence:
  - service: script.turn_on
    data_template:
      entity_id: >
        {% if is_state('switch.bathroom_wall', 'on') %}
          script.mirror_on
        {% else %}
          script.mirror_off
        {% endif %}

mirror_on:
  alias: Mirror On
  sequence:
  - service: light.turn_on
    data_template:
      entity_id: light.bathroom_mirror_inside_inner
      white_value: 255
      kelvin: >
        {% if is_state('sun.sun', 'below_horizon') %}
          3000
        {% else %}
          6500
        {% endif %}
        
mirror_off:
  alias: Mirror Off
  sequence:
  - service: light.turn_off
    data:
      entity_id: light.bathroom_mirror_inside_inner

mirror_update_ambiance:
  sequence:
  - service: script.turn_on
    data_template:
      entity_id: >
        {% if not(is_state('light.bathroom_mirror_inside_inner', 'on') or
                  is_state('switch.bathroom_heater', 'on')) %}
          script.mirror_update_ambiance_off
        {% elif is_state('switch.bathroom_heater', 'on') %}
          script.mirror_update_ambiance_on_heater
        {% else %}
          script.mirror_update_ambiance_on_normal
        {% endif %}
#  - service: notify.file
#    data:
#      message: "mirror_update_ambiance"

mirror_update_ambiance_off:
  sequence:
  - service: light.turn_off
    data:
      entity_id: light.bathroom_mirror_outside_right #group.mirror_ambiance
#  - service: notify.file
#    data:
#      message: "mirror_update_ambiance_off"

mirror_update_ambiance_on_normal:
  sequence:
  - service: light.turn_on
    data_template:
      entity_id: light.bathroom_mirror_outside_right #group.mirror_ambiance
      brightness: 255
      color_name: >
        {% if is_state('sun.sun', 'below_horizon') %}
          coral
        {% else %}
          deepskyblue
        {% endif %}
#  - service: notify.file
#    data:
#      message: "mirror_update_ambiance_on_normal"

mirror_update_ambiance_on_heater:
  sequence:
  - service: light.turn_on
    data:
      entity_id: light.bathroom_mirror_outside_right #group.mirror_ambiance
      brightness: 255
      color_name: red
#  - service: notify.file
#    data:
#      message: "mirror_update_ambiance_on_heater"

mirror_cool:
  alias: Mirror Test Cool
  sequence:
  - data:
      entity_id: light.bathroom_mirror_inside_inner, light.bathroom_mirror_outside_right
      kelvin: 6500
      white_value: 255
    service: light.turn_on
  - data:
      entity_id: light.bathroom_mirror_outside_left
      kelvin: 3000
      white_value: 255
    service: light.turn_on

mirror_warm:
  alias: Mirror Test Warm
  sequence:
  - service: light.turn_on
    data:
      entity_id: light.bathroom_mirror_inside_inner, light.bathroom_mirror_outside_right
      white_value: 255
      kelvin: 3000
  - service: light.turn_on
    data:
      entity_id: light.bathroom_mirror_outside_left
      white_value: 255
      kelvin: 6500

nightlight_update:
  sequence:
  - service: zwave.set_config_parameter
    data_template:
      node_id: 8
      parameter: 21  # Status Mode LED Color
      # Possible values: 0-7
      # 0=Off, 1=Red, 2=Green, 3=Blue, 4=Magenta, 5=Yellow, 6=Cyan, 7=White
      value: >
        {% if is_state('switch.bathroom_nightlight', 'on') %}
          White
        {% else %}
          Blue
        {% endif %}
